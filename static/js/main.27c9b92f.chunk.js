(this["webpackJsonpgpt-knowledge-system"]=this["webpackJsonpgpt-knowledge-system"]||[]).push([[0],{153:function(e,t,s){},154:function(e,t,s){},155:function(e,t,s){},281:function(e,t,s){},282:function(e,t,s){},295:function(e,t,s){},296:function(e,t,s){},298:function(e,t,s){},510:function(e,t,s){},511:function(e,t,s){},512:function(e,t,s){"use strict";s.r(t);var c=s(0),a=s(67),n=s.n(a),r=s(19),o=(s(281),s(282),s(153),s(154),s(155),s(21)),i=s(1);var l=function(e){let{isOpen:t,onLinkClick:s}=e;return Object(i.jsx)("nav",{className:"sidebar "+(t?"active":""),children:Object(i.jsxs)("ul",{children:[Object(i.jsx)("li",{children:Object(i.jsx)(o.b,{to:"/",onClick:s,children:"\u9996\u9801"})}),Object(i.jsx)("li",{children:Object(i.jsx)(o.b,{to:"/knowledge",onClick:s,children:"\u77e5\u8b58\u5eab"})}),Object(i.jsx)("li",{children:Object(i.jsx)(o.b,{to:"/documents",onClick:s,children:"\u6587\u6a94\u7ba1\u7406"})}),Object(i.jsx)("li",{children:Object(i.jsx)(o.b,{to:"/collaboration",onClick:s,children:"\u5354\u4f5c\u4e2d\u5fc3"})}),Object(i.jsx)("li",{children:Object(i.jsx)(o.b,{to:"/analytics",onClick:s,children:"\u6578\u64da\u5206\u6790"})}),Object(i.jsx)("li",{children:Object(i.jsx)(o.b,{to:"/feedback",onClick:s,children:"\u53cd\u994b"})})]})})},d=s(517);const j=d.a.create({baseURL:"http://localhost:5000",headers:{"Content-Type":"application/json"}});j.interceptors.request.use((e=>(console.log("API Request:",e.method.toUpperCase(),e.url),e)),(e=>(console.error("API Request Error:",e),Promise.reject(e)))),j.interceptors.response.use((e=>(console.log("API Response:",e.config.url,e.data),e)),(e=>{var t;return console.error("API Response Error:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),Promise.reject(e)}));var b=j;var h=function(){const[e,t]=Object(c.useState)([]),[s,a]=Object(c.useState)([]),[n,r]=Object(c.useState)(""),[o,l]=Object(c.useState)("likes"),[d,b]=Object(c.useState)(null),[h,u]=Object(c.useState)(!1),[O,x]=Object(c.useState)("\u5168\u90e8");Object(c.useEffect)((()=>{(async()=>{try{const e=await j.get("/api/questions");console.log("Fetched questions:",e.data.data);const s=(e.data.data||[]).map((e=>({...e,likes:e.likes||0})));t(s),m(s,n,o)}catch(e){console.error("Error fetching questions:",e)}})()}),[n,o]);const m=(e,t,s)=>{let c=e.filter((e=>e.question.toLowerCase().includes(t.toLowerCase())));"likes"===s?c.sort(((e,t)=>t.likes-e.likes)):"newest"===s&&c.sort(((e,t)=>new Date(t.created_at)-new Date(e.created_at))),a(c)};return Object(i.jsxs)("div",{className:"knowledge-base",style:{minHeight:"calc(100vh - 140px)"},children:[Object(i.jsx)("h1",{children:"\u77e5\u8b58\u5eab"}),Object(i.jsxs)("div",{className:"knowledge-controls",children:[Object(i.jsx)("input",{type:"text",placeholder:"\u641c\u5c0b\u554f\u984c...",value:n,onChange:e=>r(e.target.value),className:"search-box"}),Object(i.jsx)("select",{value:O,onChange:e=>x(e.target.value),className:"sort-dropdown",children:["\u5168\u90e8","IT","\u4eba\u8cc7","\u8ca1\u52d9","\u884c\u653f","\u7e3d\u52d9","\u6cd5\u52d9","\u63a1\u8cfc","\u7814\u767c","\u884c\u92b7","\u5ba2\u670d","\u77e5\u8b58\u7ba1\u7406"].map((e=>Object(i.jsx)("option",{value:e,children:e},e)))}),Object(i.jsx)("button",{onClick:async()=>{try{const e=new URLSearchParams;n&&e.append("keyword",n),O&&"\u5168\u90e8"!==O&&e.append("category",O);const s=await j.get(`/search?${e.toString()}`);t(s.data.data||[]),m(s.data.data||[],n,o)}catch(e){console.error("\u641c\u5c0b\u5931\u6557:",e),alert("\u641c\u5c0b\u5931\u6557\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66")}},style:{marginLeft:"8px"},children:"\u641c\u5c0b"}),Object(i.jsxs)("select",{className:"sort-dropdown",value:o,onChange:e=>l(e.target.value),children:[Object(i.jsx)("option",{value:"likes",children:"\u71b1\u9580"}),Object(i.jsx)("option",{value:"newest",children:"\u6700\u65b0"})]})]}),Object(i.jsxs)("table",{className:"knowledge-table",children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"\u554f\u984c"}),Object(i.jsx)("th",{children:"\u5206\u985e"}),Object(i.jsx)("th",{children:"\u8b9a"}),Object(i.jsx)("th",{children:"\u65e5\u671f"})]})}),Object(i.jsx)("tbody",{children:s.map(((e,t)=>Object(i.jsxs)("tr",{onClick:()=>(b(e),void u(!0)),children:[Object(i.jsx)("td",{children:e.question}),Object(i.jsx)("td",{children:e.category||"\u672a\u5206\u985e"}),Object(i.jsx)("td",{children:Object(i.jsxs)("span",{style:{backgroundColor:"#e3f2fd",border:"1px solid #e0e0e0",padding:"8px 16px",borderRadius:"4px",cursor:"default",display:"flex",alignItems:"center",gap:"5px"},children:["\ud83d\udc4d ",e.likes]})}),Object(i.jsx)("td",{children:new Date(e.created_at).toLocaleDateString()})]},e._id)))})]}),h&&d&&Object(i.jsx)("div",{className:"modal-overlay",onClick:()=>u(!1),children:Object(i.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[Object(i.jsx)("h2",{children:d.question}),Object(i.jsx)("p",{children:d.answer}),Object(i.jsxs)("div",{className:"modal-actions",children:[Object(i.jsxs)("button",{onClick:()=>(async s=>{try{if(!(await j.post(`/api/questions/${s}/like`)).data.success)throw new Error("\u9ede\u8b9a\u5931\u6557");const c=e.map((e=>e._id===s?{...e,likes:e.likes+1}:e));t(c),m(c,n,o)}catch(r){var c,a;console.error("Error liking question:",r),alert("\u9ede\u8b9a\u5931\u6557\uff1a"+((null===(c=r.response)||void 0===c||null===(a=c.data)||void 0===a?void 0:a.error)||"\u8acb\u7a0d\u5f8c\u518d\u8a66"))}})(d._id),style:{backgroundColor:"#e3f2fd",color:"#000",border:"none",padding:"8px 16px",borderRadius:"4px",cursor:"default",marginRight:"10px",pointerEvents:"none"},children:["\ud83d\udc4d \u9ede\u8b9a (",d.likes,")"]}),Object(i.jsx)("button",{onClick:()=>{u(!1),b(null)},style:{backgroundColor:"#6c757d",color:"#fff",border:"none",padding:"8px 16px",borderRadius:"4px",cursor:"pointer"},children:"\u95dc\u9589"})]})]})})]})};var u=function(){const[e,t]=Object(c.useState)([]),[s,a]=Object(c.useState)(!1),n=async()=>{try{const e=await fetch("/api/files"),s=await e.json();s.success?t(s.files):t([])}catch{t([])}};return Object(c.useEffect)((()=>{n()}),[]),Object(i.jsxs)("div",{className:"document-management",children:[Object(i.jsx)("h1",{children:"\u6587\u6a94\u7ba1\u7406"}),Object(i.jsx)("div",{className:"upload-section",children:Object(i.jsx)("input",{type:"file",onChange:async e=>{const t=e.target.files[0];if(!t)return;a(!0);const s=new FormData;s.append("file",t);try{const e=localStorage.getItem("token"),t=await fetch("/api/upload",{method:"POST",headers:e?{Authorization:"Bearer "+e}:{},body:s}),c=await t.json();c.success?(n(),alert("\u4e0a\u50b3\u6210\u529f")):alert(c.error||"\u4e0a\u50b3\u5931\u6557")}catch{alert("\u4e0a\u50b3\u5931\u6557")}a(!1)},className:"file-input",disabled:s})}),Object(i.jsxs)("div",{className:"file-list",children:[Object(i.jsx)("h2",{children:"\u5df2\u4e0a\u50b3\u6587\u4ef6"}),Object(i.jsx)("ul",{children:e.map(((e,t)=>Object(i.jsxs)("li",{className:"file-item",children:[Object(i.jsx)("span",{className:"file-name",children:e.filename}),Object(i.jsxs)("span",{style:{marginLeft:12,color:"#888",fontSize:14},children:["\u4e0a\u50b3\u8005\uff1a",e.uploader||"\u672a\u77e5"]}),Object(i.jsx)("span",{style:{marginLeft:12,color:"#888",fontSize:14},children:e.upload_time?new Date(e.upload_time).toLocaleString():""}),Object(i.jsx)("a",{className:"download-btn",href:`/api/download/${encodeURIComponent(e.filename)}`,download:e.filename,style:{marginLeft:12},children:"\u4e0b\u8f09"})]},t)))})]})]})},O=(s(295),s(113));s(296);const x={todo:[],inProgress:[],done:[]};var m=()=>{const[e,t]=Object(c.useState)(x),[s,a]=Object(c.useState)(""),[n,r]=Object(c.useState)("todo");return Object(i.jsxs)("div",{className:"task-board-container",children:[Object(i.jsx)("h2",{children:"\ud83d\udcdd \u4efb\u52d9\u770b\u677f"}),Object(i.jsxs)("form",{onSubmit:c=>{if(c.preventDefault(),!s.trim())return;const r={id:Date.now().toString(),content:s.trim()};t({...e,[n]:[...e[n],r]}),a("")},style:{marginBottom:16,display:"flex",gap:8},children:[Object(i.jsx)("input",{type:"text",placeholder:"\u8f38\u5165\u65b0\u4efb\u52d9\u5167\u5bb9...",value:s,onChange:e=>a(e.target.value),style:{flex:1,fontSize:16,padding:8}}),Object(i.jsxs)("select",{value:n,onChange:e=>r(e.target.value),style:{fontSize:16,padding:8},children:[Object(i.jsx)("option",{value:"todo",children:"\u5f85\u8655\u7406"}),Object(i.jsx)("option",{value:"inProgress",children:"\u9032\u884c\u4e2d"}),Object(i.jsx)("option",{value:"done",children:"\u5df2\u5b8c\u6210"})]}),Object(i.jsx)("button",{type:"submit",style:{fontSize:16,padding:"8px 16px"},children:"\u65b0\u589e\u4efb\u52d9"})]}),Object(i.jsx)(O.a,{onDragEnd:s=>{const{source:c,destination:a}=s;if(!a)return;const n=Array.from(e[c.droppableId]),r=Array.from(e[a.droppableId]),[o]=n.splice(c.index,1);c.droppableId===a.droppableId?(n.splice(a.index,0,o),t({...e,[c.droppableId]:n})):(r.splice(a.index,0,o),t({...e,[c.droppableId]:n,[a.droppableId]:r}))},children:Object(i.jsx)("div",{className:"task-columns",children:Object.entries(e).map((s=>{let[c,a]=s;return Object(i.jsx)(O.c,{droppableId:c,children:s=>Object(i.jsxs)("div",{className:"task-column",ref:s.innerRef,...s.droppableProps,children:[Object(i.jsx)("h3",{children:"todo"===c?"\ud83d\udccc \u5f85\u8655\u7406":"inProgress"===c?"\ud83d\udea7 \u9032\u884c\u4e2d":"\u2705 \u5df2\u5b8c\u6210"}),a.map(((s,a)=>Object(i.jsx)(O.b,{draggableId:s.id,index:a,children:a=>Object(i.jsxs)("div",{className:"task-card",ref:a.innerRef,...a.draggableProps,...a.dragHandleProps,style:{display:"flex",alignItems:"center",gap:8,...a.draggableProps.style},children:[Object(i.jsx)("span",{style:{flex:1},children:s.content}),Object(i.jsx)("button",{onClick:()=>((s,c)=>{t({...e,[s]:e[s].filter((e=>e.id!==c))})})(c,s.id),style:{background:"#ff4d4f",color:"#fff",border:"none",borderRadius:4,padding:"2px 8px",cursor:"pointer"},title:"\u522a\u9664\u4efb\u52d9",children:"\u522a\u9664"})]})},s.id))),s.placeholder]})},c)}))})})]})};var p=function(){const[e,t]=Object(c.useState)([]),[s,a]=Object(c.useState)("");return Object(i.jsx)("div",{className:"collaboration-container",children:Object(i.jsxs)("div",{className:"content-wrapper",children:[Object(i.jsx)("h1",{className:"collaboration-title",children:"\ud83d\udfe3 \u5354\u4f5c\u4e2d\u5fc3"}),Object(i.jsx)(m,{}),Object(i.jsx)("h2",{className:"section-title",children:"\ud83d\udcdd \u7559\u8a00\u8a0e\u8ad6\u5340"}),Object(i.jsxs)("div",{className:"comment-section",children:[Object(i.jsx)("div",{className:"comment-list",children:e.map((e=>Object(i.jsxs)("div",{className:"comment",children:[Object(i.jsxs)("strong",{children:[e.user,"\uff1a"]})," ",e.text]},e.id)))}),Object(i.jsxs)("div",{className:"comment-input",children:[Object(i.jsx)("textarea",{value:s,onChange:e=>a(e.target.value),placeholder:"\u7559\u4e0b\u4f60\u7684\u8a0e\u8ad6\u7559\u8a00..."}),Object(i.jsx)("button",{onClick:()=>{if(""!==s.trim()){const c={id:e.length+1,user:"\u4f60",text:s};t([...e,c]),a("")}},children:"\u9001\u51fa"})]})]})]})})},f=s(514),g=s(515),y=s(110),v=s(111),w=s(54),k=s(73),S=s(270),N=s(516),C=s(112),E=s(518),I=s(271),A=s(109);s(298);var _=function(){const[e,t]=Object(c.useState)([]),[s,a]=Object(c.useState)([]),[n,r]=Object(c.useState)([]),[o,l]=Object(c.useState)([]),[d,j]=Object(c.useState)("monthly");Object(c.useEffect)((()=>{fetch("/api/questions").then((e=>e.json())).then((e=>{const s=e.data||[];if("weekly"===d){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],c=Array(7).fill(0);s.forEach((e=>{const t=new Date(e.created_at);c[t.getDay()]++})),t(e.map(((e,t)=>({date:e,count:c[t]}))))}else{const e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=Array(12).fill(0);s.forEach((e=>{const t=new Date(e.created_at);c[t.getMonth()]++})),t(e.map(((e,t)=>({date:e,count:c[t]}))))}const c={};s.forEach((e=>{const t=e.category||"\u672a\u5206\u985e";c[t]=(c[t]||0)+(e.likes||0)})),a(Object.entries(c).map((e=>{let[t,s]=e;return{category:t,likes:s}})));const n={};s.forEach((e=>{const t=e.category||"\u672a\u5206\u985e";n[t]=(n[t]||0)+1})),r(Object.entries(n).map((e=>{let[t,s]=e;return{name:t,value:s}})));const o={};s.forEach((e=>{const t=e.username||e.user||e.uploader||"";t&&(o[t]=(o[t]||0)+1)})),l(Object.entries(o).map((e=>{let[t,s]=e;return{username:t,count:s}})).sort(((e,t)=>t.count-e.count)).slice(0,10))}))}),[d]);const b=["#8884d8","#82ca9d","#ffc658","#ff8042"];return Object(i.jsxs)("div",{className:"data-analysis",children:[Object(i.jsx)("h1",{children:"\ud83d\udcca \u6578\u64da\u5206\u6790"}),Object(i.jsxs)("div",{className:"time-filter",children:[Object(i.jsx)("label",{children:"\u6642\u9593\u7bc4\u570d\uff1a"}),Object(i.jsxs)("select",{value:d,onChange:e=>j(e.target.value),children:[Object(i.jsx)("option",{value:"weekly",children:"\u8fd1\u4e00\u9031"}),Object(i.jsx)("option",{value:"monthly",children:"\u8fd1\u4e00\u6708"})]})]}),Object(i.jsx)("section",{children:Object(i.jsxs)("div",{className:"analysis-section",children:[Object(i.jsx)("h2",{children:"\ud83d\udfe2 \u554f\u7b54\u91cf\u8da8\u52e2"}),Object(i.jsxs)(f.a,{width:600,height:300,data:e,children:[Object(i.jsx)(g.a,{strokeDasharray:"3 3"}),Object(i.jsx)(y.a,{dataKey:"date"}),Object(i.jsx)(v.a,{allowDecimals:!1}),Object(i.jsx)(w.a,{}),Object(i.jsx)(k.a,{}),Object(i.jsx)(S.a,{type:"monotone",dataKey:"count",stroke:"#007bff",activeDot:{r:8}})]})]})}),Object(i.jsx)("section",{children:Object(i.jsxs)("div",{className:"analysis-section",children:[Object(i.jsx)("h2",{children:"\ud83d\udfe1 \u5404\u5206\u985e\u9ede\u8b9a\u6578"}),Object(i.jsxs)(N.a,{width:600,height:300,data:s,children:[Object(i.jsx)(g.a,{strokeDasharray:"3 3"}),Object(i.jsx)(y.a,{dataKey:"category"}),Object(i.jsx)(v.a,{}),Object(i.jsx)(w.a,{}),Object(i.jsx)(C.a,{dataKey:"likes",fill:"#ff8042"})]})]})}),Object(i.jsx)("section",{children:Object(i.jsxs)("div",{className:"analysis-section",children:[Object(i.jsx)("h2",{children:"\ud83d\udd35 \u6700\u53d7\u6b61\u8fce\u5206\u985e"}),Object(i.jsxs)(E.a,{width:400,height:300,children:[Object(i.jsx)(I.a,{data:n,cx:"50%",cy:"50%",outerRadius:100,fill:"#8884d8",dataKey:"value",label:!0,children:n.map(((e,t)=>Object(i.jsx)(A.a,{fill:b[t%b.length]},`cell-${t}`)))}),Object(i.jsx)(w.a,{})]})]})}),Object(i.jsx)("section",{children:Object(i.jsxs)("div",{className:"analysis-section",children:[Object(i.jsx)("h2",{children:"\ud83d\udc64 \u4f7f\u7528\u8005\u6d3b\u8e8d\u6392\u884c\u699c"}),Object(i.jsxs)("table",{className:"active-users-table",children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"#"}),Object(i.jsx)("th",{children:"\u4f7f\u7528\u8005"}),Object(i.jsx)("th",{children:"\u554f\u7b54\u6578"})]})}),Object(i.jsx)("tbody",{children:o.map(((e,t)=>Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:t+1}),Object(i.jsx)("td",{children:e.username}),Object(i.jsx)("td",{children:e.count})]},e.username)))})]})]})})]})};var T=function(){const[e,t]=Object(c.useState)(""),[s,a]=Object(c.useState)(""),[n,r]=Object(c.useState)(0),[o,l]=Object(c.useState)(!1),[d,j]=Object(c.useState)(!1),[h,u]=Object(c.useState)(null),[O,x]=Object(c.useState)(null),[m,p]=Object(c.useState)(!1),[f,g]=Object(c.useState)("");return Object(i.jsxs)("div",{className:"App",children:[Object(i.jsx)("h1",{children:"AI \u77e5\u8b58\u5eab\u554f\u7b54\u7cfb\u7d71"}),Object(i.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),e.trim()){l(!0),u(""),a(""),p(!1),r(0),j(!1);try{let s=localStorage.getItem("username")||"anonymous";const c=await b.post("/ask",{question:e,username:s});if(a(c.data.answer||""),g(c.data.category||""),x(c.data.questionId),void 0!==c.data.likes&&r(c.data.likes),c.data.isCollected?p(!0):p(!1),!c.data.questionId)throw new Error("\u672a\u6536\u5230\u554f\u984c ID");localStorage.setItem("currentQuestionId",c.data.questionId),u(null),t("")}catch(h){console.error("Error:",h),"\u672a\u6536\u5230\u554f\u984c ID"!==h.message&&(u(h.message||"\u767c\u751f\u932f\u8aa4\uff1a\u8acb\u7a0d\u5f8c\u518d\u8a66"),alert(h.message||"\u767c\u751f\u932f\u8aa4\uff1a\u8acb\u7a0d\u5f8c\u518d\u8a66"))}finally{l(!1)}}else alert("\u8acb\u8f38\u5165\u554f\u984c")},className:"question-box",children:[Object(i.jsx)("textarea",{placeholder:"\u8acb\u8f38\u5165\u60a8\u7684\u554f\u984c...",value:e,onChange:e=>t(e.target.value),disabled:o}),Object(i.jsx)("button",{type:"submit",disabled:o,children:o?"\u6b63\u5728\u601d\u8003...":"\u2728 \u63d0\u554f"})]}),s&&Object(i.jsxs)("div",{className:"answer-box",children:[Object(i.jsx)("h2",{children:"\u2728 AI \u56de\u7b54\uff1a"}),Object(i.jsx)("p",{children:s}),Object(i.jsxs)("div",{style:{display:"flex",gap:"10px",marginTop:"15px"},children:[Object(i.jsx)("button",{onClick:()=>{if(!m)return r(n+1),j(!0),void alert("\u6b64\u554f\u984c\u5c1a\u672a\u6536\u85cf\uff0c\u9ede\u8b9a\u50c5\u66ab\u5b58\u65bc\u672c\u5730");(async()=>{try{const e=O||localStorage.getItem("currentQuestionId");if(!e)return r(n+1),j(!0),void alert("\u6b64\u554f\u984c\u5c1a\u672a\u6536\u85cf\uff0c\u9ede\u8b9a\u50c5\u66ab\u5b58\u65bc\u672c\u5730");const t=await b.post(`/api/questions/${e}/like`);if(!t.data.success)throw new Error(t.data.error||"\u9ede\u8b9a\u5931\u6557");r(n+1),j(!0),u(null)}catch(h){console.error("Error liking:",h),u(h.message||"\u9ede\u8b9a\u5931\u6557\uff1a\u8acb\u7a0d\u5f8c\u518d\u8a66"),alert(h.message||"\u9ede\u8b9a\u5931\u6557\uff1a\u8acb\u7a0d\u5f8c\u518d\u8a66")}})()},disabled:d,title:m?"":"\u6b64\u554f\u984c\u5c1a\u672a\u6536\u85cf\uff0c\u9ede\u8b9a\u50c5\u66ab\u5b58\u65bc\u672c\u5730",children:d?"\u5df2\u9ede\u8b9a":`\ud83d\udc4d \u9ede\u8b9a (${n})`}),Object(i.jsx)("button",{onClick:async()=>{try{if(!s)throw new Error("\u6c92\u6709\u53ef\u6536\u85cf\u7684\u7b54\u6848");if(m)return void alert("\u6b64\u554f\u984c\u5df2\u6536\u85cf\u5230\u6578\u64da\u5eab");const c=await b.post("/collect",{question:e,answer:s,category:f,likes:n});var t;if(!c.data||c.data.error)throw new Error((null===(t=c.data)||void 0===t?void 0:t.error)||"\u6536\u85cf\u5931\u6557");p(!0),"/knowledge"===window.location.pathname?window.location.reload():window.location.href="/knowledge"}catch(h){console.error("Error saving:",h),u(h.message||"\u6536\u85cf\u5931\u6557\uff1a\u8acb\u7a0d\u5f8c\u518d\u8a66"),alert(h.message||"\u6536\u85cf\u5931\u6557\uff1a\u8acb\u7a0d\u5f8c\u518d\u8a66")}},disabled:m||!s,children:m?"\u5df2\u6536\u85cf":"\u2728 \u6536\u85cf\u5230\u6578\u64da\u5eab"})]})]}),h&&Object(i.jsx)("div",{style:{color:"red",marginTop:"20px"},children:"\u672a\u6536\u5230\u554f\u984c ID"===h?null:h})]})};var D=()=>{const[e,t]=Object(c.useState)(""),[s,a]=Object(c.useState)(""),n=localStorage.getItem("username")||"anonymous";return Object(i.jsxs)("div",{style:{maxWidth:600,margin:"0 auto",padding:24},children:[Object(i.jsx)("h2",{style:{textAlign:"center"},children:"\u53cd\u994b"}),Object(i.jsxs)("form",{onSubmit:async s=>{if(s.preventDefault(),e.trim())try{await d.a.post("/api/feedback",{username:n,feedback:e.trim()}),a("\u611f\u8b1d\u60a8\u7684\u53cd\u994b\uff01"),t("")}catch(c){a("\u9001\u51fa\u5931\u6557\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\u3002")}else a("\u8acb\u8f38\u5165\u60a8\u7684\u53cd\u994b\u5167\u5bb9\u3002")},children:[Object(i.jsx)("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:"\u8acb\u8f38\u5165\u60a8\u7684\u53cd\u994b...",rows:6,style:{width:"100%",marginBottom:16,resize:"vertical"}}),Object(i.jsx)("div",{style:{textAlign:"center"},children:Object(i.jsx)("button",{type:"submit",style:{background:"#4caf50",color:"#fff",padding:"8px 24px",border:"none",borderRadius:4},children:"\u9001\u51fa\u53cd\u994b"})})]}),s&&Object(i.jsx)("div",{style:{textAlign:"center",color:s.includes("\u611f\u8b1d")?"green":"red",marginTop:12},children:s})]})};function P(e){let{adminUser:t}=e;const s=Object(r.f)();return Object(c.useEffect)((()=>{t||s.push("/admin/login")}),[t,s]),Object(i.jsxs)("div",{className:"admin-dashboard",children:[Object(i.jsx)("h1",{children:"\u7ba1\u7406\u54e1\u5f8c\u53f0"}),Object(i.jsx)("ul",{children:Object(i.jsx)("li",{children:Object(i.jsx)(o.b,{to:"/admin/qa",children:"\u554f\u7b54\u7ba1\u7406"})})})]})}function R(e){let{adminToken:t}=e;const[s,a]=Object(c.useState)([]),[n,r]=Object(c.useState)(""),[o,l]=Object(c.useState)("");Object(c.useEffect)((()=>{fetch("/api/questions",{headers:{Authorization:`Bearer ${t}`}}).then((e=>e.json())).then((e=>{e.success?a(e.questions||e.data||[]):r(e.error||"\u8b80\u53d6\u5931\u6557")})).catch((()=>r("\u9023\u7dda\u932f\u8aa4")))}),[t]);return Object(i.jsxs)("div",{className:"knowledge-base",style:{minHeight:"calc(100vh - 140px)"},children:[Object(i.jsx)("h1",{children:"\u554f\u7b54\u7ba1\u7406"}),n&&Object(i.jsx)("div",{style:{color:"red"},children:n}),Object(i.jsxs)("div",{className:"knowledge-controls",children:[Object(i.jsx)("input",{type:"text",placeholder:"\u641c\u5c0b\u554f\u984c...",value:o,onChange:e=>l(e.target.value),className:"search-box"}),Object(i.jsx)("button",{onClick:async()=>{try{const e=new URLSearchParams;o&&e.append("keyword",o);const s=await fetch(`/search?${e.toString()}`,{headers:{Authorization:`Bearer ${t}`}}),c=await s.json();c.success?a(c.data||[]):r(c.error||"\u641c\u5c0b\u5931\u6557")}catch{r("\u641c\u5c0b\u5931\u6557")}},style:{marginLeft:"8px"},children:"\u641c\u5c0b"})]}),Object(i.jsxs)("table",{className:"knowledge-table",children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"\u554f\u984c"}),Object(i.jsx)("th",{children:"\u5206\u985e"}),Object(i.jsx)("th",{children:"\u8b9a"}),Object(i.jsx)("th",{children:"\u65e5\u671f"}),Object(i.jsx)("th",{children:"\u64cd\u4f5c"})]})}),Object(i.jsx)("tbody",{children:s.map((e=>Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:e.question}),Object(i.jsx)("td",{children:e.category||"\u672a\u5206\u985e"}),Object(i.jsxs)("td",{children:["\ud83d\udc4d ",e.likes||0]}),Object(i.jsx)("td",{children:e.created_at?new Date(e.created_at).toLocaleDateString():""}),Object(i.jsx)("td",{children:Object(i.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u78ba\u5b9a\u8981\u522a\u9664\u9019\u500b\u554f\u984c\u55ce\uff1f"))try{const c=await fetch(`/api/questions/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}}),n=await c.json();n.success?a(s.filter((t=>t._id!==e))):r(n.error||"\u522a\u9664\u5931\u6557")}catch{r("\u9023\u7dda\u932f\u8aa4")}})(e._id),className:"delete-button",style:{backgroundColor:"#dc3545",color:"#fff",border:"none",padding:"8px 16px",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"\u2716\ufe0f \u522a\u9664"})})]},e._id)))})]})]})}s(510);const $=[{path:"/admin/dashboard",label:"\u7e3d\u89bd"},{path:"/admin/qa",label:"\u554f\u7b54\u7ba1\u7406"},{path:"/admin/user-management",label:"\u7528\u6236\u7ba1\u7406"},{path:"/admin/feedback-management",label:"\u53cd\u994b\u7ba1\u7406"}];function q(e){let{onLinkClick:t}=e;const s=Object(r.g)();return Object(i.jsx)("nav",{className:"admin-sidebar",children:Object(i.jsx)("ul",{children:$.map((e=>Object(i.jsx)("li",{className:s.pathname===e.path?"active":"",children:Object(i.jsx)(o.b,{to:e.path,onClick:t,children:e.label})},e.path)))})})}s(511);const L=Object({NODE_ENV:"production",PUBLIC_URL:"/GPT-Knowledge-System",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"http://localhost:5000";function F(){const e=Object(r.f)(),[t,s]=Object(c.useState)([]),[a,n]=Object(c.useState)(""),[o,l]=Object(c.useState)(!0),[d,j]=Object(c.useState)(null),[b,h]=Object(c.useState)(!1),[u,O]=Object(c.useState)({name:"",password:"",role:"user"}),[x,m]=Object(c.useState)(null),[p,f]=Object(c.useState)({name:"",password:"",role:"user"}),g=localStorage.getItem("token");Object(c.useEffect)((()=>{(async()=>{l(!0);try{const e=localStorage.getItem("token");if(!e)return console.error("No token found"),void j("Authentication required");console.log("Fetching users with token:",e);const t=await fetch(`${L}/api/users`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});console.log("Response status:",t.status);const c=await t.json();if(console.log("Response data:",c),403===t.status)return void j("You do not have permission to access this page");c.success?s((c.users||[]).map((e=>({id:e._id,name:e.username,role:e.role||(e.isAdmin?"admin":"user")})))):(console.error("Error in response:",c.error),j(c.error||"Failed to fetch users"))}catch(e){console.error("Fetch error:",e),j("Failed to fetch users: "+e.message)}finally{l(!1)}})()}),[e,g]);const y=t.filter((e=>e.name.toLowerCase().includes(a.toLowerCase()))),v=e=>{const{name:t,value:s}=e.target;f((e=>({...e,[t]:s})))},w=e=>{const{name:t,value:s}=e.target;O((e=>({...e,[t]:s})))};return o?Object(i.jsx)("div",{children:"Loading..."}):d?Object(i.jsxs)("div",{children:["Error: ",d]}):Object(i.jsxs)("div",{className:"admin-user-management",children:[Object(i.jsx)("h1",{children:"\u7528\u6236\u7ba1\u7406"}),Object(i.jsxs)("div",{className:"search-bar",children:[Object(i.jsx)("input",{type:"text",placeholder:"\u641c\u5c0b\u7528\u6236...",value:a,onChange:e=>{n(e.target.value)}}),Object(i.jsx)("button",{className:"add-user-btn",onClick:()=>h(!0),children:"\u65b0\u589e\u7528\u6236"})]}),b&&Object(i.jsxs)("div",{className:"add-user-form",children:[Object(i.jsx)("h2",{children:"\u65b0\u589e\u7528\u6236"}),Object(i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{l(!0);const e=await fetch(`${L}/api/register`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({username:u.name,password:u.password})}),c=await e.json();e.ok&&c.userId?("admin"===u.role&&await fetch(`${L}/api/users/${c.userId}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({role:"admin"})}),s([...t,{id:c.userId,name:u.name,role:u.role}]),O({name:"",password:"",role:"user"}),h(!1)):j(c.error||"Failed to add user")}catch(c){j("Failed to add user")}finally{l(!1)}},children:[Object(i.jsxs)("div",{className:"form-group",children:[Object(i.jsx)("label",{children:"\u7528\u6236\u540d\uff1a"}),Object(i.jsx)("input",{type:"text",name:"name",value:u.name,onChange:w,required:!0})]}),Object(i.jsxs)("div",{className:"form-group",children:[Object(i.jsx)("label",{children:"\u5bc6\u78bc\uff1a"}),Object(i.jsx)("input",{type:"password",name:"password",value:u.password,onChange:w,required:!0})]}),Object(i.jsxs)("div",{className:"form-group",children:[Object(i.jsx)("label",{children:"\u89d2\u8272\uff1a"}),Object(i.jsxs)("select",{name:"role",value:u.role,onChange:w,children:[Object(i.jsx)("option",{value:"user",children:"\u4e00\u822c\u7528\u6236"}),Object(i.jsx)("option",{value:"admin",children:"\u7ba1\u7406\u54e1"})]})]}),Object(i.jsxs)("div",{className:"form-actions",children:[Object(i.jsx)("button",{type:"submit",className:"submit-btn",children:"\u65b0\u589e"}),Object(i.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>h(!1),children:"\u53d6\u6d88"})]})]})]}),x&&Object(i.jsxs)("div",{className:"edit-user-form add-user-form",children:[Object(i.jsx)("h2",{children:"\u7de8\u8f2f\u7528\u6236"}),Object(i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{l(!0);const e={role:p.role};p.name!==x.name&&(e.name=p.name),p.password&&(e.password=p.password);const c=await fetch(`${L}/api/users/${x.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify(e)}),a=await c.json();a.success?(s(t.map((e=>e.id===x.id?{...e,name:p.name,role:p.role}:e))),m(null),f({name:"",password:"",role:"user"})):j(a.error||"Failed to update user")}catch(c){j("Failed to update user")}finally{l(!1)}},children:[Object(i.jsxs)("div",{className:"form-group",children:[Object(i.jsx)("label",{children:"\u7528\u6236\u540d\uff1a"}),Object(i.jsx)("input",{type:"text",name:"name",value:p.name,onChange:v,required:!0})]}),Object(i.jsxs)("div",{className:"form-group",children:[Object(i.jsx)("label",{children:"\u65b0\u5bc6\u78bc\uff1a"}),Object(i.jsx)("input",{type:"password",name:"password",value:p.password,onChange:v,placeholder:"\u7559\u7a7a\u8868\u793a\u4e0d\u4fee\u6539\u5bc6\u78bc"})]}),Object(i.jsxs)("div",{className:"form-group",children:[Object(i.jsx)("label",{children:"\u89d2\u8272\uff1a"}),Object(i.jsxs)("select",{name:"role",value:p.role,onChange:v,children:[Object(i.jsx)("option",{value:"user",children:"\u4e00\u822c\u7528\u6236"}),Object(i.jsx)("option",{value:"admin",children:"\u7ba1\u7406\u54e1"})]})]}),Object(i.jsxs)("div",{className:"form-actions",children:[Object(i.jsx)("button",{type:"submit",className:"submit-btn",children:"\u4fdd\u5b58"}),Object(i.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>{m(null),f({name:"",password:"",role:"user"})},children:"\u53d6\u6d88"})]})]})]}),Object(i.jsx)("div",{className:"user-list",children:Object(i.jsxs)("table",{children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"\u7528\u6236\u540d"}),Object(i.jsx)("th",{children:"\u89d2\u8272"}),Object(i.jsx)("th",{children:"\u64cd\u4f5c"})]})}),Object(i.jsx)("tbody",{children:y.map((e=>Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:e.name}),Object(i.jsx)("td",{children:"admin"===e.role?"\u7ba1\u7406\u54e1":"\u4e00\u822c\u7528\u6236"}),Object(i.jsxs)("td",{children:[Object(i.jsx)("button",{onClick:()=>(async(e,c)=>{try{l(!0);const a="admin"===c?"user":"admin",n=await fetch(`${L}/api/users/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({role:a})}),r=await n.json();r.success?s(t.map((t=>t.id===e?{...t,role:a}:t))):j(r.error||"Failed to update user role")}catch(a){j("Failed to update user role")}finally{l(!1)}})(e.id,e.role),className:"admin"===e.role?"remove-admin":"make-admin",children:"admin"===e.role?"\u53d6\u6d88\u7ba1\u7406\u54e1":"\u8a2d\u70ba\u7ba1\u7406\u54e1"}),Object(i.jsx)("button",{onClick:()=>(e=>{m(e),f({name:e.name,password:"",role:e.role})})(e),className:"edit-user",children:"\u7de8\u8f2f"}),Object(i.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this user?"))try{l(!0);const c=await fetch(`${L}/api/users/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${g}`}}),a=await c.json();a.success?s(t.filter((t=>t.id!==e))):j(a.error||"Failed to delete user")}catch(c){j("Failed to delete user")}finally{l(!1)}})(e.id),className:"delete-user",children:"\u522a\u9664"})]})]},e.id)))})]})})]})}const z=Object({NODE_ENV:"production",PUBLIC_URL:"/GPT-Knowledge-System",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL||"http://localhost:5000";function B(){Object(r.f)();const[e,t]=Object(c.useState)([]),[s,a]=Object(c.useState)(!0),[n,o]=Object(c.useState)(null),l=localStorage.getItem("token");Object(c.useEffect)((()=>{(async()=>{a(!0);try{const e=await fetch(`${z}/api/feedback`,{headers:{Authorization:`Bearer ${l}`}}),s=await e.json();s.success?t(s.feedbacks||[]):o(s.error||"Failed to fetch feedback")}catch(e){o("Failed to fetch feedback: "+e.message)}finally{a(!1)}})()}),[l]);return s?Object(i.jsx)("div",{children:"\u8f09\u5165\u4e2d..."}):n?Object(i.jsxs)("div",{style:{color:"red"},children:["Error: ",n]}):Object(i.jsxs)("div",{style:{padding:"24px"},children:[Object(i.jsx)("h2",{children:"\u53cd\u994b\u7ba1\u7406"}),Object(i.jsxs)("table",{border:"1",cellPadding:"8",style:{width:"100%",marginTop:"16px"},children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{children:"\u7528\u6236\u540d"}),Object(i.jsx)("th",{children:"\u5167\u5bb9"}),Object(i.jsx)("th",{children:"\u63d0\u4ea4\u6642\u9593"}),Object(i.jsx)("th",{children:"\u64cd\u4f5c"})]})}),Object(i.jsx)("tbody",{children:0===e.length?Object(i.jsx)("tr",{children:Object(i.jsx)("td",{colSpan:"4",children:"\u66ab\u7121\u53cd\u994b"})}):e.map((s=>Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:s.username}),Object(i.jsx)("td",{children:s.content}),Object(i.jsx)("td",{children:new Date(s.created_at).toLocaleString()}),Object(i.jsx)("td",{children:Object(i.jsx)("button",{onClick:()=>(async s=>{if(window.confirm("\u78ba\u5b9a\u8981\u522a\u9664\u6b64\u53cd\u994b\u55ce\uff1f")){a(!0);try{const c=await fetch(`${z}/api/feedback/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}}),a=await c.json();a.success?t(e.filter((e=>e._id!==s))):o(a.error||"Failed to delete feedback")}catch(c){o("Failed to delete feedback: "+c.message)}finally{a(!1)}}})(s._id),style:{color:"red"},children:"\u522a\u9664"})})]},s._id)))})]})]})}var K=s(149);const U={position:"absolute",top:10,right:10,zIndex:1e3,background:"#f44336",color:"#fff",border:"none",borderRadius:"6px",padding:"6px 16px",cursor:"pointer"};var H=function(){const[e,t]=Object(c.useState)((()=>localStorage.getItem("token")||"")),[s,a]=Object(c.useState)(!1),[n]=Object(c.useState)(""),o=()=>a((e=>!e)),d=()=>{t(""),localStorage.removeItem("token")},j=Object(r.g)();let b=!1;try{const t=Object(K.a)(e);b=t&&(!0===t.isAdmin||"admin"===t.role)}catch(O){b=!1}return b&&!j.pathname.startsWith("/admin")?(window.location.replace("#/admin/dashboard"),null):!b&&j.pathname.startsWith("/admin")?(window.location.replace("#/"),null):b?Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("button",{className:"hamburger",onClick:o,children:"\u2630"}),Object(i.jsx)("button",{onClick:d,style:U,children:"\u767b\u51fa"}),Object(i.jsxs)("div",{className:"app-container",children:[Object(i.jsx)(q,{}),Object(i.jsx)("div",{className:"content",style:{marginLeft:200},children:Object(i.jsxs)(r.c,{children:[Object(i.jsx)(r.a,{exact:!0,path:"/admin/dashboard",component:P}),Object(i.jsx)(r.a,{path:"/admin/qa",render:()=>Object(i.jsx)(R,{adminToken:e})}),Object(i.jsx)(r.a,{path:"/admin/user-management",component:F}),Object(i.jsx)(r.a,{path:"/admin/feedback-management",component:B})]})})]})]}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("button",{className:"hamburger",onClick:o,children:"\u2630"}),Object(i.jsx)("button",{onClick:d,style:U,children:"\u767b\u51fa"}),Object(i.jsxs)("div",{className:"app-container",children:[Object(i.jsx)(l,{isOpen:s,onLinkClick:()=>a(!1)}),Object(i.jsx)("div",{className:"content",children:Object(i.jsxs)(r.c,{children:[Object(i.jsx)(r.a,{exact:!0,path:"/",component:T}),Object(i.jsx)(r.a,{path:"/knowledge",component:h}),Object(i.jsx)(r.a,{path:"/documents",render:()=>Object(i.jsx)(u,{user:n})}),Object(i.jsx)(r.a,{path:"/collaboration",component:p}),Object(i.jsx)(r.a,{path:"/analytics",component:_}),Object(i.jsx)(r.a,{path:"/feedback",component:D})]})})]})]})};n.a.render(Object(i.jsx)(o.a,{children:Object(i.jsx)(H,{})}),document.getElementById("root"))}},[[512,1,2]]]);
//# sourceMappingURL=main.27c9b92f.chunk.js.map